<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Генератор розкладу</title>
    <!-- Styles -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2@4.0.13/dist/css/select2.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2-bootstrap-5-theme@1.3.0/dist/select2-bootstrap-5-theme.min.css" />
    <!-- Or for RTL support -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2-bootstrap-5-theme@1.3.0/dist/select2-bootstrap-5-theme.rtl.min.css" />

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.0/dist/jquery.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.0.13/dist/js/select2.full.min.js"></script>
    <script src="./schedule.js"></script>
</head>
<body>
    <div class="container ">
        <div class="row px-3">
        <div class="row text-center my-3 pt-3">
            <h1>Генератор розкладу</h1>
        </div>
        <form>
            <div class="row border d-flex justify-content-center mb-3 rounded-3 bg-light">
                <h2 class="my-2">Пуджа</h2>
                <div class="row mb-3">
                    <div class="col-xs-12 col-md-4">
                        <div class="row mb-3">
                            <h4 class="text-center fw-normal fst-italic">- Ранок ДБС -</h4>
                            <select class="form-select" multiple id="pujaMorningJBS"></select>
                        </div>
                        <div class="row mb-3">
                            <h4 class="text-center fw-normal fst-italic">- Ранок НГ -</h4>
                            <select class="form-select" multiple id="pujaMorningGN"></select>
                        </div>
                    </div>
                    <div class="col-xs-12 col-md-4">
                        <div class="row mb-3">
                            <h4 class="text-center fw-normal fst-italic">- Обід ДБС -</h4>
                            <select class="form-select" multiple id="pujaNoonJBS"></select>
                        </div>
                        <div class="row mb-3">
                            <h4 class="text-center fw-normal fst-italic">- Обід НГ -</h4>
                            <select class="form-select" multiple id="pujaNoonGN"></select>
                        </div>
                    </div>
                    <div class="col-xs-12 col-md-4">
                        <div class="row mb-3">
                            <h4 class="text-center fw-normal fst-italic">- Вечір ДБС -</h4>
                            <select class="form-select" multiple id="pujaEveningJBS"></select>
                        </div>
                        <div class="row mb-3">
                            <h4 class="text-center fw-normal fst-italic">- Вечір НГ -</h4>
                            <select class="form-select" multiple id="pujaEveningGN"></select>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row border d-flex justify-content-center mb-3 rounded-3 bg-light">
                <h2 class="my-2">Кухня</h2>
                <div class="row mb-3">
                    <div class="col-xs-12 col-md-6">
                        <div class="row mb-3">
                            <h3 class="text-center fw-normal fst-italic">- Сніданок -</h3>
                            <select class="form-select" multiple id="kitchenBreakfast"></select>
                        </div>
                    </div>
                    <div class="col-xs-12 col-md-6">
                        <div class="row mb-3">
                            <h3 class="text-center fw-normal fst-italic">- Обід -</h3>
                            <select class="form-select" multiple id="kitchenDinner"></select>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row border d-flex justify-content-center mb-3 rounded-3 bg-light">
                <h2 class="my-2">Гірлянди</h2>
                <div class="row mb-3">
                    <div class="col-xs-12 col-md-4">
                        <div class="row mb-3">
                            <h3 class="text-center fw-normal fst-italic">- ВГН -</h3>
                            <select class="form-select" multiple id="garlandsBGN"></select>
                        </div>
                    </div>
                    <div class="col-xs-12 col-md-4">
                        <div class="row mb-3">
                            <h3 class="text-center fw-normal fst-italic">- ДБС -</h3>
                            <select class="form-select" multiple id="garlandsJBS"></select>
                        </div>
                    </div>
                    <div class="col-xs-12 col-md-4">
                        <div class="row mb-3">
                            <h3 class="text-center fw-normal fst-italic">- СГН -</h3>
                            <select class="form-select" multiple id="garlandsMGN"></select>
                        </div>
                    </div>
                    <div class="col-xs-12 col-md-4">
                        <div class="row mb-3">
                            <h3 class="text-center fw-normal fst-italic">- МГН -</h3>
                            <select class="form-select" multiple id="garlandsSGN"></select>
                        </div>
                    </div>
                    <div class="col-xs-12 col-md-4">
                        <div class="row mb-3">
                            <h3 class="text-center fw-normal fst-italic">- МШП -</h3>
                            <select class="form-select" multiple id="garlandsSSP"></select>
                        </div>
                    </div>
                    <div class="col-xs-12 col-md-4">
                        <div class="row mb-3">
                            <h3 class="text-center fw-normal fst-italic">- ВШП -</h3>
                            <select class="form-select" multiple id="garlandsBSP"></select>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row border d-flex justify-content-center mb-3 rounded-3 bg-light">
                <h2 class="my-2">Шріла Прабгупада</h2>
                <div class="row mb-3">
                    <div class="col-xs-12 col-md-6">
                        <div class="row mb-3">
                            <h3 class="text-center fw-normal fst-italic">- Переодягання -</h3>
                            <select class="form-select" multiple id="clothes"></select>
                        </div>
                    </div>
                    <div class="col-xs-12 col-md-6">
                        <div class="row mb-3">
                            <h3 class="text-center fw-normal fst-italic">- В'ясасана та букети -</h3>
                            <select class="form-select" multiple id="vyasasana"></select>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row border d-flex justify-content-center mb-3 rounded-3 bg-light">
                <h2 class="my-2">Помічники</h2>
                <div class="row mb-3">
                    <div class="col-xs-12 col-md-6">
                        <div class="row mb-3 ">
                            <select class="form-select" multiple id="assistants"></select>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row border d-flex justify-content-center mb-3 rounded-3 bg-light">
                <div class="col-md-12 my-3">
                    <h3 class="d-inline-block me-3">Розклад</h3>
                    <button type="button" class="btn btn-primary d-inline-block me-3" onclick="createSchedule()">Генерувати</button>
                    <button type="button" class="btn btn-success" onclick="copyToClipboard()">Копіювати</button>

                </div>
                <div class="mb-3">
                    <textarea class="form-control" rows="42" id="result"></textarea>
                </div>
            </div>
        </form>
        </div>
    </div>
    <script>
        document.getElementById("result").value = generateSchedule(defaultSchedule);

        const defaultSelectedValues = {};
        for (const [key, devotees] of Object.entries(defaultSchedule)) {
            const values = devotees.map(({ id }) => id);
            defaultSelectedValues[key] = values;
        }

        for (const [id, selectedValues] of Object.entries(defaultSelectedValues)) {
            const select = document.getElementById(id);
            for (const [key, devotee] of Object.entries(d)) {
                const option = document.createElement('option');
                option.value = key;
                option.innerHTML = `${devotee.name} ${devotee.gender}`;
                option.selected = selectedValues.includes(option.value);
                select.appendChild(option);
            }
            $( `#${id}` ).select2( { 
                theme: 'bootstrap-5',
                placeholder: 'Оберіть відданного',
                allowClear: true
            } );
        }

        function copyToClipboard() {
            var copyText = document.getElementById("result");
            copyText.select();
            copyText.setSelectionRange(0, 99999); // For mobile devices
            navigator.clipboard.writeText(copyText.value);
        }

        function getSelectValues(select) {
            var result = [];
            var options = select && select.options;
            var opt;

            for (var i=0, iLen=options.length; i<iLen; i++) {
                opt = options[i];

                if (opt.selected) {
                result.push(opt.value || opt.text);
                }
            }
            return result;
        }

        function createSchedule() {
            const getDevoteeById = (id) => d[id];
            const actualSchedule = {
                pujaMorningJBS: getSelectValues(document.getElementById("pujaMorningJBS")).map(getDevoteeById),
                pujaMorningGN: getSelectValues(document.getElementById("pujaMorningGN")).map(getDevoteeById), 
                pujaNoonJBS: getSelectValues(document.getElementById("pujaNoonJBS")).map(getDevoteeById), 
                pujaNoonGN: getSelectValues(document.getElementById("pujaNoonGN")).map(getDevoteeById), 
                pujaEveningJBS: getSelectValues(document.getElementById("pujaEveningJBS")).map(getDevoteeById), 
                pujaEveningGN: getSelectValues(document.getElementById("pujaEveningGN")).map(getDevoteeById), 
                kitchenBreakfast: getSelectValues(document.getElementById("kitchenBreakfast")).map(getDevoteeById), 
                kitchenDinner: getSelectValues(document.getElementById("kitchenDinner")).map(getDevoteeById), 
                garlandsBGN: getSelectValues(document.getElementById("garlandsBGN")).map(getDevoteeById), 
                garlandsJBS: getSelectValues(document.getElementById("garlandsJBS")).map(getDevoteeById), 
                garlandsMGN: getSelectValues(document.getElementById("garlandsMGN")).map(getDevoteeById), 
                garlandsSGN: getSelectValues(document.getElementById("garlandsSGN")).map(getDevoteeById), 
                garlandsSSP: getSelectValues(document.getElementById("garlandsSSP")).map(getDevoteeById), 
                garlandsBSP: getSelectValues(document.getElementById("garlandsBSP")).map(getDevoteeById), 
                clothes: getSelectValues(document.getElementById("clothes")).map(getDevoteeById), 
                vyasasana: getSelectValues(document.getElementById("vyasasana")).map(getDevoteeById), 
                assistants: getSelectValues(document.getElementById("assistants")).map(getDevoteeById), 
            };
            document.getElementById("result").value = generateSchedule(actualSchedule);
        }
    </script>
</body>
</html>